<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Vagrant | Code Life]]></title>
  <link href="http://blog.code-life.net/blog/categories/vagrant/atom.xml" rel="self"/>
  <link href="http://blog.code-life.net/"/>
  <updated>2014-02-06T10:21:55+09:00</updated>
  <id>http://blog.code-life.net/</id>
  <author>
    <name><![CDATA[noto]]></name>
    <email><![CDATA[noto.code.life@gmail.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[[Vagrant]パブリックネットワークの設定]]></title>
    <link href="http://blog.code-life.net/blog/2013/12/01/vagrant-configure-public-network/"/>
    <updated>2013-12-01T15:39:00+09:00</updated>
    <id>http://blog.code-life.net/blog/2013/12/01/vagrant-configure-public-network</id>
    <content type="html"><![CDATA[<p>Vagrantでパブリックネットワークの設定をしようとしたところ、若干ハマったのでメモ。</p>

<h2>環境</h2>

<ul>
<li>Vagrant 1.3.2</li>
</ul>


<h2>Public Network</h2>

<p><a href="http://docs.vagrantup.com/v2/networking/public_network.html">公式のドキュメント</a>通りに設定し、vagrant reload すれば設定が反映されます。</p>

<p><code>ruby
config.vm.network :public_network,  :bridge =&gt; 'en1: Wi-Fi (AirPort)'
</code></p>

<h2>Xdubug</h2>

<p>public networkで起動したらサイトがクソ重くなる&hellip;</p>

<p>色々調べたところ <a href="https://github.com/10up/varying-vagrant-vagrants/wiki/Configure-for-a-Public-Network">Configure for a Public-Network</a> に記載されてる方法で解決することができました。</p>

<h3>xdubug.ini</h3>

<p>xdubug.ini もしくは php.iniに以下の一文を追加</p>

<p><code>sh
xdebug.remote_connect_back = 1
</code></p>

<p>Xdebug使ってる人は要注意です。</p>

<h2>参考</h2>

<p><a href="https://github.com/10up/varying-vagrant-vagrants/wiki/Configure-for-a-Public-Network">Configure for a Public-Network</a></p>

<p><a href="http://stackoverflow.com/questions/18241065/auto-setting-xdebug-remote-host-ip-address-with-vagrant-puppet">Auto setting xdebug.remote_host ip address with vagrant/puppet</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[Vagrant]共有ディレクトリのマウントが失敗する]]></title>
    <link href="http://blog.code-life.net/blog/2013/09/26/vagrant-mounting-failed/"/>
    <updated>2013-09-26T22:58:00+09:00</updated>
    <id>http://blog.code-life.net/blog/2013/09/26/vagrant-mounting-failed</id>
    <content type="html"><![CDATA[<h2>環境</h2>

<ul>
<li><p>HOST</p>

<ul>
<li>Mac OS X 10.8</li>
<li>Vagrant 1.3.2</li>
<li>Virtual Box 4.2.18</li>
<li>ruby 1.9.3p392</li>
</ul>
</li>
<li><p>GUEST</p>

<ul>
<li>CentOS 6.3 minimal</li>
</ul>
</li>
</ul>


<h2>エラー内容</h2>

<p>vagrantから新規仮想マシンを作成し、ホストOSとゲストOSの共有ディレクトリの設定後、起動させたところ
下記のエラーが出力された。</p>

<p>``` sh
The following SSH command responded with a non-zero exit status.
Vagrant assumes that this means the command failed!</p>

<p>mount -t vboxsf -o uid=<code>id -u vagrant</code>,gid=<code>getent group vagrant | cut -d: -f3</code> /share /share</p>

<p>Stdout from the command:</p>

<p>Stderr from the command:</p>

<p>/sbin/mount.vboxsf: mounting failed with the error: No such device
```</p>

<p>Guest additionsが正常にインストールされていないようなので /var/log/vboxadd-install.log を確認する。</p>

<p>```
test -e include/linux/autoconf.h -a -e include/config/auto.conf || (            \</p>

<pre><code>    echo;                                                           \
    echo "  ERROR: Kernel configuration is invalid.";               \
    echo "         include/linux/autoconf.h or include/config/auto.conf are missing.";      \
    echo "         Run 'make oldconfig &amp;&amp; make prepare' on kernel src to fix it.";  \
    echo;                                                           \
    /bin/false)
</code></pre>

<p>```</p>

<p>automake, autoconf がインストールされてない&hellip;</p>

<p><code>sh
$ sudo yum install automake autoconf
</code></p>

<h2>Guest additionsの再インストール</h2>

<p>ログアウト後</p>

<p><code>sh
$ vagrant vbguest --do install # requier vagrant-vbguest
$ vagrant reload
</code></p>

<p>これで共有設定が反映される。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Vagrant1.2.2から1.3.2にあげたらvagrant-vbguestが動作しない]]></title>
    <link href="http://blog.code-life.net/blog/2013/09/18/vagrant-vbguest-update/"/>
    <updated>2013-09-18T21:57:00+09:00</updated>
    <id>http://blog.code-life.net/blog/2013/09/18/vagrant-vbguest-update</id>
    <content type="html"><![CDATA[<p>久しぶりに<a href="http://www.vagrantup.com/">Vagrant</a>を触ったついでにupdateした結果 <a href="https://github.com/dotless-de/vagrant-vbguest">vagrant-vbguest</a>がエラー吐く。</p>

<p>エラー吐くどころかvagrant upもできない始末。
<a href="https://github.com/dotless-de/vagrant-vbguest">vagrant-vbguest</a>自身もupdateしていたので反映させてみました。</p>

<h2>環境</h2>

<ul>
<li>Mac OS X 10.8</li>
<li>Vagrant 1.3.2</li>
<li>Virtual Box 4.2.18</li>
<li>ruby 1.9.3p392</li>
</ul>


<h2>エラー内容</h2>

<p><code> sh
/Users/noto/.vagrant.d/gems/gems/vagrant-vbguest-0.8.0/lib/vagrant-vbguest/vagrant_compat.rb:7:in `&lt;top (required)&gt;': undefined method `[]' for nil:NilClass (NoMethodError)
</code></p>

<h2>Global Configuration</h2>

<p><a href="http://blog.code-life.net/blog/2013/06/10/the-guest-additions-on-this-vm-do-not-match-the-installed-version-of-virtualbox-on-vagrant/">以前</a>設定したグローバルの設定をコメントアウト</p>

<p><code>sh
$ vi ~/.vagrant.d/Vagrantfile
</code></p>

<p>``` ruby</p>

<h1>Vagrant.configure(&ldquo;2&rdquo;) do |config|</h1>

<h1>require &lsquo;vagrant-vbguest&rsquo; unless defined? config.vbguest</h1>

<h1>config.vbguest.auto_update = false</h1>

<h1>end</h1>

<p>```</p>

<h2>Update vagrant-vbguest</h2>

<p>さくっと一発</p>

<p><code>sh
$ vagrant plugin update vagrant-vbguest
</code></p>

<h2>Global Configuration再び</h2>

<p>updateが完了したら、globalの設定のコメントを外します。これでエラーの出力がなくなるはずです。</p>

<p>ちなみに<a href="https://github.com/dotless-de/vagrant-vbguest/blob/master/Readme.md">README</a>に記載されてる設定では以前と同様にエラーになりました。</p>

<h3>エラーの内容はこちら</h3>

<p>``` sh
Vagrant failed to initialize at a very early stage:</p>

<p>There was an error loading a Vagrantfile. The file being loaded
and the error message are shown below. This is usually caused by
a syntax error.</p>

<p>Path: /Users/noto/.vagrant.d/Vagrantfile
Message: uninitialized constant VagrantVbguest::Config
```</p>

<p><a href="https://github.com/dotless-de/vagrant-vbguest/issues/73">uninitialized constant VagrantVbguest::Config when using global configuration</a>でも同じこと言われてます。</p>

<h2>Guest Additionsのバージョン確認</h2>

<p><code>sh
$ vagrant up # 起動させていないなら
$ vagrant vbguest --status
GuestAdditions versions on your host (4.2.18) and guest (4.2.12) do not match.
</code></p>

<h2>Update Guestadditions</h2>

<p><code>sh
$ vagrant up # 起動させていないなら
$ vagrant vbguest --do install
</code></p>

<p>設定すべて外してstatusとdoコマンド利用すればいいんじゃないかなと思ってきました。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[Vagrant] 仮想マシンのスナップショットとるならvagrant-vbox-snapshotが便利]]></title>
    <link href="http://blog.code-life.net/blog/2013/06/12/vagrant-vbox-snapshot/"/>
    <updated>2013-06-12T21:25:00+09:00</updated>
    <id>http://blog.code-life.net/blog/2013/06/12/vagrant-vbox-snapshot</id>
    <content type="html"><![CDATA[<p>vagrant1.2で仮想マシンのスナップショットをとりたかったので調べたところ <a href="https://github.com/dergachev/vagrant-vbox-snapshot">vagrant-vbox-snapshot</a>なるものが公開されていたのでインストールしてみました。</p>

<p>似たプラグインで<a href="https://github.com/ryuzee/sahara">sahara</a>がありますが、sandboxモードで動作させることができるプラグインのようでスナップショットをとる機能はないようです。
google先生に伺ってもsaharaの記事は多くヒットするのですが、vagrant-vbox-snapshotはあまりヒットしないのは需要がないんですかね。</p>

<h2>環境</h2>

<ul>
<li>Mac OS X 10.8</li>
<li>Vagrant 1.2.2</li>
<li>Virtual Box 4.2.12</li>
</ul>


<h2>Requirements</h2>

<ul>
<li>Vagrant 1.1+</li>
</ul>


<h2>インストール</h2>

<p>さくっとインスト</p>

<p><code>sh
$ vagrant plugin install vagrant-vbox-snapshot
</code></p>

<h2>使い方</h2>

<p><a href="https://github.com/dergachev/vagrant-vbox-snapshot/blob/master/README.md">README</a> に書いてあるまんまですが。</p>

<h2>スナップショットの作成</h2>

<p>スナップショット名を指定して作成します。</p>

<p><code>sh
$ vagrant snapshot take [NAME]
</code></p>

<h2>スナップショットの一覧</h2>

<p><code>sh
$ vagrant snapshot list
</code></p>

<h3>出力結果</h3>

<p>複数のスナップショットをとっている場合、以下のように出力されます。</p>

<p>``` sh
   Name: init (UUID: c45af534-e64a-409e-95f7-1a7ef697f7cc)</p>

<pre><code>  Name: before-AMP (UUID: 97dfc94b-f0ba-45b9-9bc4-c43c8b251d22) *
</code></pre>

<p>```</p>

<h2>スナップショットに復元</h2>

<p>指定した名前のスナップショットに復元します。</p>

<p><code>sh
$ vagrant snapshot go [NAME]
</code></p>

<h2>直前のスナップショットに復元</h2>

<p><code>sh
$ vagrant snapshot back
</code></p>

<h2>スナップショットの削除</h2>

<p>指定した名前のスナップショットを削除します。</p>

<p><code>sh
$ vagrant snapshot delete [NAME]
</code></p>

<p>ひと通りコマンドを試してみましたが問題なく動作しています。</p>

<p>Vagrant便利っすね。</p>

<h2>参考</h2>

<p><a href="https://github.com/dergachev/vagrant-vbox-snapshot#vagrant-vbox-snapshot">vagrant-vbox-snapshot</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[Vagrant] VirtualBoxのバージョンとGuest Additionsのバージョンが合わない場合の対処法]]></title>
    <link href="http://blog.code-life.net/blog/2013/06/10/the-guest-additions-on-this-vm-do-not-match-the-installed-version-of-virtualbox-on-vagrant/"/>
    <updated>2013-06-10T23:33:00+09:00</updated>
    <id>http://blog.code-life.net/blog/2013/06/10/the-guest-additions-on-this-vm-do-not-match-the-installed-version-of-virtualbox-on-vagrant</id>
    <content type="html"><![CDATA[<p>遅ればせながらvagrantを触り始めました。今のところ単純なことしかしてないのでほとんど詰まるところはありませんが、仮想マシンを起動した際にVirtualBoxのバージョンとGuest additionsのバージョンが一致しないと怒られたのでその解決方法です。</p>

<h2>環境</h2>

<ul>
<li>Mac OS X 10.8</li>
<li>vagrant 1.2.2</li>
<li>ruby 1.9.3 (rbenv)</li>
</ul>


<h2>アラート内容</h2>

<p>```
[default] The guest additions on this VM do not match the installed version of
VirtualBox! In most cases this is fine,   but in rare cases it can
cause things such as shared folders to not work properly. If you see
shared folder errors,   please update the guest additions within the
virtual machine and reload your VM.</p>

<p>Guest Additions Version: 4.1.18
VirtualBox Version: 4.2
```</p>

<h2>vagrant-vbguest</h2>

<p><a href="https://github.com/dotless-de/vagrant-vbguest">vagrant-vbguest</a> は自動的にGuest Additionsを更新してくれるプラグインです。</p>

<p>このプラグインをインストールし up or reload で自動的に新しいバージョンのGuest Additions がインストールされます。</p>

<h3>Install</h3>

<p><code>sh
$ vagrant plugin install vagrant-vbguest
</code></p>

<h3>Configuration</h3>

<p>vagrant-vbguestはインスタンス起動時に毎回自動で更新の確認を行うようなのでグローバルはOFFにして
利用するプロジェクト場合はOnに設定します。</p>

<h4>Global Configuration</h4>

<p>~/.vagrant.d/ 以下にVagrantfileが存在する場合、この設定ファイルを読みに行くようなのでglobalの設定として
vagrant-vbguest の自動更新をOFFになるよう設定します。</p>

<p>1.2.2ではDocumentに記載されている方法でエラーが発生したので変更を加えます。</p>

<p><code>sh
$ vi ~/.vagrant.d/Vagrantfile
</code></p>

<p>``` ruby</p>

<h1>1.2.2ではエラーになった</h1>

<p>require &lsquo;vagrant-vbguest&rsquo; unless defined? VagrantVbguest::Config
VagrantVbguest::Config.auto_update = false</p>

<h1>こっちだとうまくいく</h1>

<p>Vagrant.configure(&ldquo;2&rdquo;) do |config|
  require &lsquo;vagrant-vbguest&rsquo; unless defined? config.vbguest
  config.vbguest.auto_update = false
end
```</p>

<p>ruby殆ど知らないのですがvbguestのconfigを初期化して値を設定してる感じでしょう。</p>

<h4>Project Configuration</h4>

<p>プロジェクト固有の設定です。auto_updateが有効になるよう設定を加えます。</p>

<p><code>sh
$ vi /path/to/vagrant_project/Vagrantfile
</code></p>

<p>``` ruby</p>

<h1>set auto_update to false,  if do NOT want to check the correct additions</h1>

<h1>version when booting this machine</h1>

<p>config.vbguest.auto_update = true
```</p>

<h3>Vagrant up or reload</h3>

<p><code>sh
$ vagrant up
or
$ vagrant reload
</code></p>

<p>すると自動的にGuest Additionsをupdateしてる！素晴らしい。</p>

<p><code>sh
[default] Setting the name of the VM...
[default] Clearing any previously set forwarded ports...
[default] Creating shared folders metadata...
[default] Clearing any previously set network interfaces...
[default] Preparing network interfaces based on configuration...
[default] Forwarding ports...
[default] -- 22 =&gt; 2222 (adapter 1)
[default] Booting VM...
[default] Waiting for VM to boot. This can take a few minutes.
[default] VM booted and ready for use!
GuestAdditions versions on your host (4.2.12) and guest (4.1.18) do not match.
Loaded plugins: fastestmirror,  presto
Loading mirror speeds from cached hostfile
 * base: mirror.fairway.ne.jp
  * extras: mirror.fairway.ne.jp
   * updates: mirror.fairway.ne.jp
   Setting up Install Process
   Package kernel-devel-2.6.32-358.6.2.el6.x86_64 already installed and latest version
   Package gcc-4.4.7-3.el6.x86_64 already installed and latest version
   Package 1:make-3.81-20.el6.x86_64 already installed and latest version
   Package 4:perl-5.10.1-131.el6_4.x86_64 already installed and latest version
   Nothing to do
   Copy iso file /Applications/VirtualBox.app/Contents/MacOS/VBoxGuestAdditions.iso into the box /tmp/VBoxGuestAdditions.iso
   Installing Virtualbox Guest Additions 4.2.12 - guest version is 4.1.18
   Verifying archive integrity... All good.
   Uncompressing VirtualBox 4.2.12 Guest Additions for Linux............
   VirtualBox Guest Additions installer
   Removing installed version 4.1.18 of VirtualBox Guest Additions...
   Copying additional installer modules ...
   Installing additional modules ...
   Removing existing VirtualBox non-DKMS kernel modules[  OK  ]
   Building the VirtualBox Guest Additions kernel modules
   Building the main Guest Additions module[  OK  ]
   Building the shared folder support module[  OK  ]
   Building the OpenGL support module[  OK  ]
   Doing non-kernel setup of the Guest Additions[  OK  ]
   Starting the VirtualBox Guest Additions [  OK  ]
   Installing the Window System drivers[FAILED]
   (Could not find the X.Org or XFree86 Window System.)
   An error occurred during installation of VirtualBox Guest Additions 4.2.12. Some functionality may not work as intended.
   [default] Configuring and enabling network interfaces...
   [default] Mounting shared folders...
   [default] -- /vagrant
</code></p>

<p>念のためvagrant sshでログインして確認する。</p>

<p><code>sh
$ ls /opt
VBoxGuestAdditions-4.2.12
</code></p>

<p>無事新しいバージョンのGuest Additionsがインストールされたことが確認できます。</p>

<h2>補足</h2>

<p><a href="http://blog.code-life.net/blog/2013/09/18/vagrant-vbguest-update/">Vagrant1.2.2から1.3.2にあげたらvagrant-vbguestが動作しない</a></p>

<h2>参考</h2>

<p><a href="https://github.com/dotless-de/vagrant-vbguest">vagrant-vbguest</a></p>

<p><a href="http://theholyjava.wordpress.com/2012/03/24/note-to-self-how-to-solve-vagrant-destroy-failing-with-error-in-api-call-in-ffi-rb/">Note To Self: What to Do When a Vagrant Machine Stops Working (Destroy or Up Failing)</a></p>
]]></content>
  </entry>
  
</feed>
