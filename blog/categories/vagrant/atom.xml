<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: vagrant | Code Life]]></title>
  <link href="http://blog.code-life.net/blog/categories/vagrant/atom.xml" rel="self"/>
  <link href="http://blog.code-life.net/"/>
  <updated>2014-08-24T22:42:12+09:00</updated>
  <id>http://blog.code-life.net/</id>
  <author>
    <name><![CDATA[noto]]></name>
    <email><![CDATA[noto.code.life@gmail.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[[Vagrant]複数の共有ディレクトリをマウントさせる]]></title>
    <link href="http://blog.code-life.net/blog/2014/04/14/vagrant-multiple-synced-folders/"/>
    <updated>2014-04-14T21:06:31+09:00</updated>
    <id>http://blog.code-life.net/blog/2014/04/14/vagrant-multiple-synced-folders</id>
    <content type="html"><![CDATA[<p>ドキュメントみてもgoogle先生に伺っても意外と情報がない。</p>

<!--more-->


<h2>環境</h2>

<ul>
<li>Vagrant 1.5.2</li>
</ul>


<h2>複数の共有ディレクトリをマウントさせる</h2>

<p>ただ複数書けばいいだけだった&hellip;</p>

<pre><code class="ruby">config.vm.synced_folder "../path_to_share1", "/share1"
config.vm.synced_folder "../path_to_share2", "/share2"
</code></pre>

<p>常識なんですかね。</p>

<h2>参考</h2>

<p><a href="http://docs.vagrantup.com/v2/synced-folders/basic_usage.html">Synced Folders</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Rails Server WEBrickの起動やレスポンス速度が遅い場合の対処法]]></title>
    <link href="http://blog.code-life.net/blog/2014/04/14/rails-server-webrick-is-so-slow/"/>
    <updated>2014-04-14T20:41:27+09:00</updated>
    <id>http://blog.code-life.net/blog/2014/04/14/rails-server-webrick-is-so-slow</id>
    <content type="html"><![CDATA[<p>最近Railsを触っているのだが、いかんせんWebrickの起動やレスポンスが遅い。</p>

<p>世のRubyistはこんな環境で開発しているのか(いやない)ということで調べた。</p>

<!--more-->


<h2>環境</h2>

<ul>
<li>Ruby on Rails4</li>
<li>ruby 2.1.1p76</li>
<li>Vagrant 1.5.2</li>
</ul>


<h2>Webrickの設定を見直す</h2>

<p>google先生に伺うと下記の解決方法が多かったがボクの環境では効果が見られなかった。</p>

<pre><code class="sh">$ gem which webrick
/home/vagrant/.rbenv/versions/2.1.1/lib/ruby/2.1.0/webrick.rb

$ vi /home/vagrant/.rbenv/versions/2.1.1/lib/ruby/2.1.0/webrick/config.rb

:DoNotReverseLookup =&gt; nil
↓
:DoNotReverseLookup =&gt; true
</code></pre>

<h2>Vagrant Synced Foldersの設定</h2>

<p>synced_folderを<code>nfs</code> にするとパフォーマンスの向上が期待できると何処かで見た記憶があったので</p>

<p>ドキュメントを覗いてみると <code>rsync</code> がバージョン1.5から利用できるとのこと。
使わない手はないと早速1.5に上げて試してみた。</p>

<pre><code class="ruby">config.vm.synced_folder "../target", "/share", type: "rsync"
</code></pre>

<p>初回起動時は立ち上がるまで若干時間がかかったが、それ以降は遅いとは感じない。</p>

<p>肝心のWebrickのレスポンス速度は劇的に上がった。今までと比べると爆速。</p>

<h3>注意点</h3>

<p>ホストOS側で変更した点がゲストOSに反映されない。
rsyncを利用する場合は <code>rsync</code> または <code>rsync-auto</code> を実行する必要がある。</p>

<pre><code>$ vagrant up
$ vagrant rsync #１度きりの同期
or
$ vagrant rsync-auto #監視して変更があれば同期 若干タイムラグがある。
</code></pre>

<h2>結局は&hellip;</h2>

<p>rsyncで少し利用してみたが、同期のラグが気になった。
変更してすぐに確認できないことがあるのでこの辺はストレスに感じる。</p>

<p>また同期は一方方向 ホスト→ ゲストの為、仮想マシン上でコマンドを打ってファイルを作成しても
ホストには反映されない。</p>

<p>自分はゲストからコマンドを打つことが多いので困った点だった。
こういった点はこれから改善されるのだと思う。</p>

<p>ということでパフォーマンス的に問題がなかったので <code>nfs</code> に変更して開発している。</p>

<hr />

<p>追記 2014/04/15</p>

<h2>参考</h2>

<p><a href="https://www.vagrantup.com/blog/feature-preview-vagrant-1-5-rsync.html">Feature Preview: Rsync Synced Folders</a></p>

<p><a href="http://docs.vagrantup.com/v2/getting-started/synced_folders.html">Synced Folders</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Vagrantのコマンドを補完する]]></title>
    <link href="http://blog.code-life.net/blog/2014/02/07/install-vagrant-bash-completion-on-mac/"/>
    <updated>2014-02-07T11:19:47+09:00</updated>
    <id>http://blog.code-life.net/blog/2014/02/07/install-vagrant-bash-completion-on-mac</id>
    <content type="html"><![CDATA[<p><a href="https://github.com/kura/vagrant-bash-completion">vagrant-bash-completion</a>なるものを発見したのでインストールした。</p>

<!--more-->


<h2>環境</h2>

<ul>
<li>Mac OS X 10.9.1</li>
<li>Vagrant 1.4.3</li>
</ul>


<h2>Installation</h2>

<pre><code class="sh">$ brew tap homebrew/completions
$ brew install vagrant-completion
</code></pre>

<p>~/.bashrcに以下を追加して反映</p>

<pre><code class="sh">if [ -f `brew --prefix`/etc/bash_completion.d/vagrant ]; then
  source `brew --prefix`/etc/bash_completion.d/vagrant
fi
</code></pre>

<p>Vagrantコマンド・サブコマンドの補完が行われて幸福度が少し上がる。</p>

<h2>参考</h2>

<p><a href="https://github.com/kura/vagrant-bash-completion">vagrant-bash-completion</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[Vagrant]パブリックネットワークの設定]]></title>
    <link href="http://blog.code-life.net/blog/2013/12/01/vagrant-configure-public-network/"/>
    <updated>2013-12-01T15:39:00+09:00</updated>
    <id>http://blog.code-life.net/blog/2013/12/01/vagrant-configure-public-network</id>
    <content type="html"><![CDATA[<p>Vagrantでパブリックネットワークの設定をしようとしたところ、若干ハマったのでメモ。</p>

<!--more-->


<h2>環境</h2>

<ul>
<li>Vagrant 1.3.2</li>
</ul>


<h2>Public Network</h2>

<p><a href="http://docs.vagrantup.com/v2/networking/public_network.html">公式のドキュメント</a>通りに設定し、vagrant reload すれば設定が反映されます。</p>

<pre><code class="ruby">config.vm.network :public_network,  :bridge =&gt; 'en1: Wi-Fi (AirPort)'
</code></pre>

<h2>Xdubug</h2>

<p>public networkで起動したらサイトがクソ重くなる&hellip;</p>

<p>色々調べたところ <a href="https://github.com/10up/varying-vagrant-vagrants/wiki/Configure-for-a-Public-Network">Configure for a Public-Network</a> に記載されてる方法で解決することができました。</p>

<h3>xdubug.ini</h3>

<p>xdubug.ini もしくは php.iniに以下の一文を追加</p>

<pre><code class="sh">xdebug.remote_connect_back = 1
</code></pre>

<p>Xdebug使ってる人は要注意です。</p>

<h2>参考</h2>

<p><a href="https://github.com/10up/varying-vagrant-vagrants/wiki/Configure-for-a-Public-Network">Configure for a Public-Network</a></p>

<p><a href="http://stackoverflow.com/questions/18241065/auto-setting-xdebug-remote-host-ip-address-with-vagrant-puppet">Auto setting xdebug.remote_host ip address with vagrant/puppet</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[Vagrant]共有ディレクトリのマウントが失敗する]]></title>
    <link href="http://blog.code-life.net/blog/2013/09/26/vagrant-mounting-failed/"/>
    <updated>2013-09-26T22:58:00+09:00</updated>
    <id>http://blog.code-life.net/blog/2013/09/26/vagrant-mounting-failed</id>
    <content type="html"><![CDATA[<h2>環境</h2>

<ul>
<li><p>HOST</p>

<ul>
<li>Mac OS X 10.8</li>
<li>Vagrant 1.3.2</li>
<li>Virtual Box 4.2.18</li>
<li>ruby 1.9.3p392</li>
</ul>
</li>
<li><p>GUEST</p>

<ul>
<li>CentOS 6.3 minimal</li>
</ul>
</li>
</ul>


<h2>エラー内容</h2>

<p>vagrantから新規仮想マシンを作成し、ホストOSとゲストOSの共有ディレクトリの設定後、起動させたところ
下記のエラーが出力された。</p>

<!--more-->


<pre><code class="sh">The following SSH command responded with a non-zero exit status.
Vagrant assumes that this means the command failed!

mount -t vboxsf -o uid=`id -u vagrant`,gid=`getent group vagrant | cut -d: -f3` /share /share

Stdout from the command:



Stderr from the command:

/sbin/mount.vboxsf: mounting failed with the error: No such device
</code></pre>

<p>Guest additionsが正常にインストールされていないようなので /var/log/vboxadd-install.log を確認する。</p>

<pre><code>test -e include/linux/autoconf.h -a -e include/config/auto.conf || (            \
        echo;                                                           \
        echo "  ERROR: Kernel configuration is invalid.";               \
        echo "         include/linux/autoconf.h or include/config/auto.conf are missing.";      \
        echo "         Run 'make oldconfig &amp;&amp; make prepare' on kernel src to fix it.";  \
        echo;                                                           \
        /bin/false)
</code></pre>

<p>automake, autoconf がインストールされてない&hellip;</p>

<pre><code class="sh">$ sudo yum install automake autoconf
</code></pre>

<h2>Guest additionsの再インストール</h2>

<p>ログアウト後</p>

<pre><code class="sh">$ vagrant vbguest --do install # requier vagrant-vbguest
$ vagrant reload
</code></pre>

<p>これで共有設定が反映される。</p>
]]></content>
  </entry>
  
</feed>
